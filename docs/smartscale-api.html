<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 SmartScale API | _main.knit</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="2 SmartScale API | _main.knit" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 SmartScale API | _main.knit" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="greenfeed-api.html"/>
<link rel="next" href="smartfeeder-api.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>C-Lock Application Program Interfaces</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#abstract"><i class="fa fa-check"></i><b>0.1</b> Abstract</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="greenfeed-api.html"><a href="greenfeed-api.html"><i class="fa fa-check"></i><b>1</b> GreenFeed API</a>
<ul>
<li class="chapter" data-level="1.1" data-path="greenfeed-api.html"><a href="greenfeed-api.html#api"><i class="fa fa-check"></i><b>1.1</b> API</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="greenfeed-api.html"><a href="greenfeed-api.html#data-download"><i class="fa fa-check"></i><b>1.1.1</b> Data Download</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="greenfeed-api.html"><a href="greenfeed-api.html#data-visualization"><i class="fa fa-check"></i><b>1.2</b> Data Visualization</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="smartscale-api.html"><a href="smartscale-api.html"><i class="fa fa-check"></i><b>2</b> SmartScale API</a>
<ul>
<li class="chapter" data-level="2.1" data-path="smartscale-api.html"><a href="smartscale-api.html#api-1"><i class="fa fa-check"></i><b>2.1</b> API</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="smartscale-api.html"><a href="smartscale-api.html#libraries"><i class="fa fa-check"></i><b>2.1.1</b> Libraries</a></li>
<li class="chapter" data-level="2.1.2" data-path="smartscale-api.html"><a href="smartscale-api.html#login-variables"><i class="fa fa-check"></i><b>2.1.2</b> Login Variables</a></li>
<li class="chapter" data-level="2.1.3" data-path="smartscale-api.html"><a href="smartscale-api.html#data-download-1"><i class="fa fa-check"></i><b>2.1.3</b> Data Download</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="smartscale-api.html"><a href="smartscale-api.html#data-processing"><i class="fa fa-check"></i><b>2.2</b> Data Processing</a></li>
<li class="chapter" data-level="2.3" data-path="smartscale-api.html"><a href="smartscale-api.html#data-visualization-1"><i class="fa fa-check"></i><b>2.3</b> Data Visualization</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="smartscale-api.html"><a href="smartscale-api.html#further-data-cleaning-and-filtering"><i class="fa fa-check"></i><b>2.3.1</b> Further Data Cleaning and Filtering</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="smartscale-api.html"><a href="smartscale-api.html#animal-performance"><i class="fa fa-check"></i><b>2.4</b> Animal Performance</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="smartfeeder-api.html"><a href="smartfeeder-api.html"><i class="fa fa-check"></i><b>3</b> SmartFeeder API</a>
<ul>
<li class="chapter" data-level="3.1" data-path="smartfeeder-api.html"><a href="smartfeeder-api.html#api-2"><i class="fa fa-check"></i><b>3.1</b> API</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="smartfeeder-api.html"><a href="smartfeeder-api.html#libraries-1"><i class="fa fa-check"></i><b>3.1.1</b> Libraries</a></li>
<li class="chapter" data-level="3.1.2" data-path="smartfeeder-api.html"><a href="smartfeeder-api.html#login-credentials"><i class="fa fa-check"></i><b>3.1.2</b> Login credentials</a></li>
<li class="chapter" data-level="3.1.3" data-path="smartfeeder-api.html"><a href="smartfeeder-api.html#report-paramters"><i class="fa fa-check"></i><b>3.1.3</b> Report paramters</a></li>
<li class="chapter" data-level="3.1.4" data-path="smartfeeder-api.html"><a href="smartfeeder-api.html#data-download-2"><i class="fa fa-check"></i><b>3.1.4</b> Data Download</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="smartfeeder-api.html"><a href="smartfeeder-api.html#smartfeeder-data-processing"><i class="fa fa-check"></i><b>3.2</b> SmartFeeder Data Processing</a></li>
<li class="chapter" data-level="3.3" data-path="smartfeeder-api.html"><a href="smartfeeder-api.html#smartfeedert-data-visualization"><i class="fa fa-check"></i><b>3.3</b> SmartFeedert Data Visualization</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>4</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="smartscale-api" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> SmartScale API<a href="smartscale-api.html#smartscale-api" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><em>Developed by Jameson Brennan, Ira Parsons, and Hector Menendez</em>
<em>Department of Animal Science, South Dakota State University</em></p>
<p>The objectives of this hands on tutorial are to introduce workshop participants to methods for streamlining SmartScale data processing tasks in R.</p>
<div id="api-1" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> API<a href="smartscale-api.html#api-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="libraries" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Libraries<a href="smartscale-api.html#libraries" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Our first step to processing the data is to import the libraries we will use to run our analysis. Each library contains a set of functions which can be used to process data. For example, the function mean() would sum the values in a column and divide by the number of observations in the column. This code will look to see if the necessary packages are installed on your computer and if not install and load them.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="smartscale-api.html#cb14-1" tabindex="-1"></a><span class="do">##if there is an error and a package or dependency needs to be updated un-comment the </span></span>
<span id="cb14-2"><a href="smartscale-api.html#cb14-2" tabindex="-1"></a><span class="co">#code below and replace &#39;rvest&#39; with package</span></span>
<span id="cb14-3"><a href="smartscale-api.html#cb14-3" tabindex="-1"></a><span class="co">#remove.packages(&#39;rvest&#39;)</span></span>
<span id="cb14-4"><a href="smartscale-api.html#cb14-4" tabindex="-1"></a><span class="co">#install.packages(&#39;rvest&#39;)</span></span>
<span id="cb14-5"><a href="smartscale-api.html#cb14-5" tabindex="-1"></a></span>
<span id="cb14-6"><a href="smartscale-api.html#cb14-6" tabindex="-1"></a><span class="co">#Needed packages</span></span>
<span id="cb14-7"><a href="smartscale-api.html#cb14-7" tabindex="-1"></a>  list.of.packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;rvest&quot;</span>,<span class="st">&#39;tidyverse&#39;</span>,<span class="st">&#39;data.table&#39;</span>,<span class="st">&#39;lubridate&#39;</span>,</span>
<span id="cb14-8"><a href="smartscale-api.html#cb14-8" tabindex="-1"></a>                        <span class="st">&#39;knitr&#39;</span>,<span class="st">&#39;markdown&#39;</span>,<span class="st">&#39;fasttime&#39;</span>,<span class="st">&#39;MASS&#39;</span>)</span>
<span id="cb14-9"><a href="smartscale-api.html#cb14-9" tabindex="-1"></a>  new.packages <span class="ot">&lt;-</span> list.of.packages[<span class="sc">!</span>(list.of.packages <span class="sc">%in%</span> </span>
<span id="cb14-10"><a href="smartscale-api.html#cb14-10" tabindex="-1"></a>                                       <span class="fu">installed.packages</span>()[,<span class="st">&quot;Package&quot;</span>])]</span>
<span id="cb14-11"><a href="smartscale-api.html#cb14-11" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(new.packages)) <span class="fu">install.packages</span>(new.packages)</span>
<span id="cb14-12"><a href="smartscale-api.html#cb14-12" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb14-13"><a href="smartscale-api.html#cb14-13" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb14-14"><a href="smartscale-api.html#cb14-14" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb14-15"><a href="smartscale-api.html#cb14-15" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb14-16"><a href="smartscale-api.html#cb14-16" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb14-17"><a href="smartscale-api.html#cb14-17" tabindex="-1"></a><span class="fu">library</span>(rmarkdown)</span>
<span id="cb14-18"><a href="smartscale-api.html#cb14-18" tabindex="-1"></a><span class="fu">library</span>(fasttime)</span>
<span id="cb14-19"><a href="smartscale-api.html#cb14-19" tabindex="-1"></a><span class="fu">library</span>(MASS)</span></code></pre></div>
</div>
<div id="login-variables" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Login Variables<a href="smartscale-api.html#login-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The first thing you need to do is to enter your variables for the code to run. In the quotations below you will need to change the username, password, FID (or SmartScale ID), and the start and end times for the data you want to download.</p>
<p>Two things to note are 1) you can enter multiple greenfeeds assocated with an account and 2) the start time and end time must be in the same format. The chunk below sets the end time to the computer time for the most recent downloads.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="smartscale-api.html#cb15-1" tabindex="-1"></a><span class="co">#change to login user name </span></span>
<span id="cb15-2"><a href="smartscale-api.html#cb15-2" tabindex="-1"></a>USERNAME <span class="ot">&lt;-</span> <span class="st">&#39;demo_user&#39;</span></span>
<span id="cb15-3"><a href="smartscale-api.html#cb15-3" tabindex="-1"></a></span>
<span id="cb15-4"><a href="smartscale-api.html#cb15-4" tabindex="-1"></a><span class="co">#Change to login password</span></span>
<span id="cb15-5"><a href="smartscale-api.html#cb15-5" tabindex="-1"></a>PASSWORD <span class="ot">&lt;-</span> <span class="st">&#39;greenfeed&#39;</span></span>
<span id="cb15-6"><a href="smartscale-api.html#cb15-6" tabindex="-1"></a></span>
<span id="cb15-7"><a href="smartscale-api.html#cb15-7" tabindex="-1"></a><span class="co">#Change SmartScale id or id&#39;s. The second line can be uncommented out for multiple </span></span>
<span id="cb15-8"><a href="smartscale-api.html#cb15-8" tabindex="-1"></a><span class="co">#SmartScales notice there is no space between commas for the multiple id&#39;s</span></span>
<span id="cb15-9"><a href="smartscale-api.html#cb15-9" tabindex="-1"></a>SmartScale_ID  <span class="ot">&lt;-</span> <span class="st">&#39;1000119&#39;</span></span>
<span id="cb15-10"><a href="smartscale-api.html#cb15-10" tabindex="-1"></a><span class="co">#SmartScale_ID   &lt;- &quot;1000119,1000121,1000132&quot;</span></span>
<span id="cb15-11"><a href="smartscale-api.html#cb15-11" tabindex="-1"></a></span>
<span id="cb15-12"><a href="smartscale-api.html#cb15-12" tabindex="-1"></a><span class="co">#enter the start date (ST) and end date (ET) for the data you want to download</span></span>
<span id="cb15-13"><a href="smartscale-api.html#cb15-13" tabindex="-1"></a>date.start <span class="ot">&lt;-</span> <span class="st">&#39;2023-03-14&#39;</span></span>
<span id="cb15-14"><a href="smartscale-api.html#cb15-14" tabindex="-1"></a>date.end   <span class="ot">&lt;-</span> <span class="st">&#39;2023-06-01&#39;</span></span>
<span id="cb15-15"><a href="smartscale-api.html#cb15-15" tabindex="-1"></a></span>
<span id="cb15-16"><a href="smartscale-api.html#cb15-16" tabindex="-1"></a><span class="do">## Data parameters -----</span></span>
<span id="cb15-17"><a href="smartscale-api.html#cb15-17" tabindex="-1"></a>FULL_WEIGHT <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># 1 for full body weight calculated using C-Lock algorithm, 0 for raw </span></span>
<span id="cb15-18"><a href="smartscale-api.html#cb15-18" tabindex="-1"></a><span class="co">#half-body weights, full weights calculated by taking the front end weight * 1.76</span></span>
<span id="cb15-19"><a href="smartscale-api.html#cb15-19" tabindex="-1"></a>GET_VISITS <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co">#Put 1 to get individual visits, Put 0 to get daily averages</span></span></code></pre></div>
</div>
<div id="data-download-1" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Data Download<a href="smartscale-api.html#data-download-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This code chunk will pull the data from the cloud based on the specifications of what was provided above.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="smartscale-api.html#cb16-1" tabindex="-1"></a><span class="co"># Local system setup ----</span></span>
<span id="cb16-2"><a href="smartscale-api.html#cb16-2" tabindex="-1"></a><span class="do">## Choose a temp folder to download the CSV to ----</span></span>
<span id="cb16-3"><a href="smartscale-api.html#cb16-3" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">Sys.info</span>()[<span class="st">&quot;sysname&quot;</span>] <span class="sc">==</span> <span class="st">&quot;Darwin&quot;</span>){</span>
<span id="cb16-4"><a href="smartscale-api.html#cb16-4" tabindex="-1"></a>  TEMP_DIRECTORY <span class="ot">&lt;-</span> <span class="st">&quot;/tmp&quot;</span> <span class="co">#For Mac or Linux</span></span>
<span id="cb16-5"><a href="smartscale-api.html#cb16-5" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb16-6"><a href="smartscale-api.html#cb16-6" tabindex="-1"></a>  TEMP_DIRECTORY <span class="ot">&lt;-</span> <span class="st">&quot;.&quot;</span>    <span class="co">#For Windows (Maybe put C:\Users\yourusername\Desktop)</span></span>
<span id="cb16-7"><a href="smartscale-api.html#cb16-7" tabindex="-1"></a>}</span>
<span id="cb16-8"><a href="smartscale-api.html#cb16-8" tabindex="-1"></a></span>
<span id="cb16-9"><a href="smartscale-api.html#cb16-9" tabindex="-1"></a><span class="do">## Load required libraries ----</span></span>
<span id="cb16-10"><a href="smartscale-api.html#cb16-10" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">suppressMessages</span>(<span class="fu">try</span>(<span class="fu">require</span>(rvest), <span class="at">silent =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb16-11"><a href="smartscale-api.html#cb16-11" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">suppressMessages</span>(<span class="fu">try</span>(<span class="fu">require</span>(httr), <span class="at">silent =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb16-12"><a href="smartscale-api.html#cb16-12" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">suppressMessages</span>(<span class="fu">try</span>(<span class="fu">require</span>(RCurl), <span class="at">silent =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb16-13"><a href="smartscale-api.html#cb16-13" tabindex="-1"></a></span>
<span id="cb16-14"><a href="smartscale-api.html#cb16-14" tabindex="-1"></a><span class="do">## Login URL -----</span></span>
<span id="cb16-15"><a href="smartscale-api.html#cb16-15" tabindex="-1"></a>login_url <span class="ot">&lt;-</span> <span class="st">&quot;https://greenfeed.c-lockinc.com/GreenFeed/checklogon.php&quot;</span></span>
<span id="cb16-16"><a href="smartscale-api.html#cb16-16" tabindex="-1"></a></span>
<span id="cb16-17"><a href="smartscale-api.html#cb16-17" tabindex="-1"></a><span class="do">## API URL -----</span></span>
<span id="cb16-18"><a href="smartscale-api.html#cb16-18" tabindex="-1"></a><span class="cf">if</span> (GET_VISITS <span class="sc">==</span> GET_VISITS) {</span>
<span id="cb16-19"><a href="smartscale-api.html#cb16-19" tabindex="-1"></a>  <span class="co">#Download URL - Individual Visits Weights</span></span>
<span id="cb16-20"><a href="smartscale-api.html#cb16-20" tabindex="-1"></a>  download_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;https://greenfeed.c-lockinc.com/GreenFeed/tabledata/sfanimals/getanimalweightdetails.php?dl=1&quot;</span>,</span>
<span id="cb16-21"><a href="smartscale-api.html#cb16-21" tabindex="-1"></a>                         <span class="st">&quot;&amp;fids=0,&quot;</span>, SmartScale_ID,</span>
<span id="cb16-22"><a href="smartscale-api.html#cb16-22" tabindex="-1"></a>                         <span class="st">&quot;&amp;st=&quot;</span>, date.start,</span>
<span id="cb16-23"><a href="smartscale-api.html#cb16-23" tabindex="-1"></a>                         <span class="st">&quot;&amp;et=&quot;</span>, date.end,</span>
<span id="cb16-24"><a href="smartscale-api.html#cb16-24" tabindex="-1"></a>                         <span class="st">&quot;&amp;full=&quot;</span>, FULL_WEIGHT);</span>
<span id="cb16-25"><a href="smartscale-api.html#cb16-25" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb16-26"><a href="smartscale-api.html#cb16-26" tabindex="-1"></a>  <span class="co">#Download URL - Daily Average Weights</span></span>
<span id="cb16-27"><a href="smartscale-api.html#cb16-27" tabindex="-1"></a>  download_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;https://greenfeed.c-lockinc.com/GreenFeed/tabledata/sfanimals/animalweights.php?dl=1&amp;summary=0&quot;</span>,</span>
<span id="cb16-28"><a href="smartscale-api.html#cb16-28" tabindex="-1"></a>                         <span class="st">&quot;&amp;fids=0,&quot;</span>, SmartScale_ID,</span>
<span id="cb16-29"><a href="smartscale-api.html#cb16-29" tabindex="-1"></a>                         <span class="st">&quot;&amp;from=&quot;</span>, date.start0,</span>
<span id="cb16-30"><a href="smartscale-api.html#cb16-30" tabindex="-1"></a>                         <span class="st">&quot;&amp;to=&quot;</span>, date.end,</span>
<span id="cb16-31"><a href="smartscale-api.html#cb16-31" tabindex="-1"></a>                         <span class="st">&quot;&amp;full=&quot;</span>, FULL_WEIGHT);</span>
<span id="cb16-32"><a href="smartscale-api.html#cb16-32" tabindex="-1"></a>}</span>
<span id="cb16-33"><a href="smartscale-api.html#cb16-33" tabindex="-1"></a></span>
<span id="cb16-34"><a href="smartscale-api.html#cb16-34" tabindex="-1"></a><span class="co"># Download data ----</span></span>
<span id="cb16-35"><a href="smartscale-api.html#cb16-35" tabindex="-1"></a><span class="do">## Log into the website using URL requests -----</span></span>
<span id="cb16-36"><a href="smartscale-api.html#cb16-36" tabindex="-1"></a>{</span>
<span id="cb16-37"><a href="smartscale-api.html#cb16-37" tabindex="-1"></a>  <span class="co">#Create session then download form data</span></span>
<span id="cb16-38"><a href="smartscale-api.html#cb16-38" tabindex="-1"></a>  session <span class="ot">&lt;-</span> <span class="fu">session</span>(<span class="st">&quot;https://greenfeed.c-lockinc.com/GreenFeed&quot;</span>)</span>
<span id="cb16-39"><a href="smartscale-api.html#cb16-39" tabindex="-1"></a>  form <span class="ot">&lt;-</span> <span class="fu">html_form</span>(<span class="fu">read_html</span>(login_url))[[<span class="dv">1</span>]]</span>
<span id="cb16-40"><a href="smartscale-api.html#cb16-40" tabindex="-1"></a>  </span>
<span id="cb16-41"><a href="smartscale-api.html#cb16-41" tabindex="-1"></a>  <span class="co">#Set login credentials</span></span>
<span id="cb16-42"><a href="smartscale-api.html#cb16-42" tabindex="-1"></a>  form <span class="ot">&lt;-</span> <span class="fu">set_values</span>(form, <span class="at">username =</span> USERNAME)</span>
<span id="cb16-43"><a href="smartscale-api.html#cb16-43" tabindex="-1"></a>  form <span class="ot">&lt;-</span> <span class="fu">set_values</span>(form, <span class="at">password =</span> PASSWORD)</span>
<span id="cb16-44"><a href="smartscale-api.html#cb16-44" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>(form <span class="ot">&lt;-</span> <span class="fu">set_values</span>(form, <span class="at">redir =</span> <span class="st">&quot;home.php?logout&quot;</span>)) <span class="co">#This will give you a warning - we can hide it with suppressWarnings</span></span>
<span id="cb16-45"><a href="smartscale-api.html#cb16-45" tabindex="-1"></a>  </span>
<span id="cb16-46"><a href="smartscale-api.html#cb16-46" tabindex="-1"></a>  <span class="co">#Save main page url</span></span>
<span id="cb16-47"><a href="smartscale-api.html#cb16-47" tabindex="-1"></a>  <span class="fu">suppressMessages</span>(main_page <span class="ot">&lt;-</span> <span class="fu">submit_form</span>(session, form))</span>
<span id="cb16-48"><a href="smartscale-api.html#cb16-48" tabindex="-1"></a>  </span>
<span id="cb16-49"><a href="smartscale-api.html#cb16-49" tabindex="-1"></a>  <span class="co">#Download the data</span></span>
<span id="cb16-50"><a href="smartscale-api.html#cb16-50" tabindex="-1"></a>  download <span class="ot">&lt;-</span> <span class="fu">jump_to</span>(main_page, download_url)</span>
<span id="cb16-51"><a href="smartscale-api.html#cb16-51" tabindex="-1"></a>}</span>
<span id="cb16-52"><a href="smartscale-api.html#cb16-52" tabindex="-1"></a></span>
<span id="cb16-53"><a href="smartscale-api.html#cb16-53" tabindex="-1"></a><span class="co"># Decode binary data ----</span></span>
<span id="cb16-54"><a href="smartscale-api.html#cb16-54" tabindex="-1"></a><span class="co">#Because the downloaded data is binary data, you must write it to a temporary file then read it back as a CSV.</span></span>
<span id="cb16-55"><a href="smartscale-api.html#cb16-55" tabindex="-1"></a><span class="do">## Write data to a file ----</span></span>
<span id="cb16-56"><a href="smartscale-api.html#cb16-56" tabindex="-1"></a>FILENAME <span class="ot">&lt;-</span> <span class="fu">paste0</span>(TEMP_DIRECTORY, <span class="st">&quot;/C.txt&quot;</span>)</span>
<span id="cb16-57"><a href="smartscale-api.html#cb16-57" tabindex="-1"></a><span class="fu">writeBin</span>(download<span class="sc">$</span>response<span class="sc">$</span>content, FILENAME)</span>
<span id="cb16-58"><a href="smartscale-api.html#cb16-58" tabindex="-1"></a></span>
<span id="cb16-59"><a href="smartscale-api.html#cb16-59" tabindex="-1"></a><span class="co">#Read the CSV into a df dataframe</span></span>
<span id="cb16-60"><a href="smartscale-api.html#cb16-60" tabindex="-1"></a><span class="cf">if</span> (GET_VISITS <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb16-61"><a href="smartscale-api.html#cb16-61" tabindex="-1"></a>  <span class="co">#SmartScale Headers are: &quot;Link&quot; &quot;StartTime&quot; &quot;StopTime&quot; &quot;FeederID&quot; &quot;Duration&quot; &quot;AnimalName&quot; &quot;RFIDTag&quot; &quot;Weight&quot; &quot;Valid&quot;</span></span>
<span id="cb16-62"><a href="smartscale-api.html#cb16-62" tabindex="-1"></a>  colclasses<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;character&quot;</span>, <span class="st">&quot;POSIXct&quot;</span>, <span class="st">&quot;POSIXct&quot;</span>, <span class="st">&quot;integer&quot;</span>, <span class="st">&quot;integer&quot;</span>, <span class="st">&quot;character&quot;</span>, <span class="st">&quot;character&quot;</span>, <span class="st">&quot;integer&quot;</span>, <span class="st">&quot;character&quot;</span>);</span>
<span id="cb16-63"><a href="smartscale-api.html#cb16-63" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb16-64"><a href="smartscale-api.html#cb16-64" tabindex="-1"></a>  <span class="co">#SmartScale Headers are: &quot;Link&quot; &quot;StartTime&quot; &quot;StopTime&quot; &quot;FeederID&quot; &quot;Duration&quot; &quot;AnimalName&quot; &quot;RFIDTag&quot; &quot;Weight&quot; &quot;Valid&quot;</span></span>
<span id="cb16-65"><a href="smartscale-api.html#cb16-65" tabindex="-1"></a>  colclasses<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;character&quot;</span>, <span class="st">&quot;character&quot;</span>);</span>
<span id="cb16-66"><a href="smartscale-api.html#cb16-66" tabindex="-1"></a>}</span>
<span id="cb16-67"><a href="smartscale-api.html#cb16-67" tabindex="-1"></a></span>
<span id="cb16-68"><a href="smartscale-api.html#cb16-68" tabindex="-1"></a>d.smart <span class="ot">=</span> <span class="fu">fread</span>(<span class="at">file =</span> FILENAME, <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>, <span class="at">quote=</span><span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&quot;</span>, <span class="at">colClasses =</span> colclasses) <span class="co"># Read into data.table</span></span>
<span id="cb16-69"><a href="smartscale-api.html#cb16-69" tabindex="-1"></a>d.smart[d.smart <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span> <span class="co"># Replace 0&#39;s with NA</span></span></code></pre></div>
</div>
</div>
<div id="data-processing" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Data Processing<a href="smartscale-api.html#data-processing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This is the raw dataset downloaded from the SmartScale API.The code chunk will print the first five rows of data in table format.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="smartscale-api.html#cb17-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>( <span class="fu">head</span>(d.smart))</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="50%" />
<col width="9%" />
<col width="9%" />
<col width="4%" />
<col width="4%" />
<col width="5%" />
<col width="11%" />
<col width="3%" />
<col width="2%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">View</th>
<th align="left">StartTime</th>
<th align="left">StopTime</th>
<th align="right">FeederID</th>
<th align="right">Duration</th>
<th align="left">AnimalName</th>
<th align="left">RFIDTag</th>
<th align="right">Weight</th>
<th align="left">Valid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><a href="https://greenfeed.c-lockinc.com/GreenFeed/sfdata.php?fid=1000119&amp;dt=2023-03-14%2018:47:22&amp;dur=60&amp;s1=20&amp;s2=23" class="uri">https://greenfeed.c-lockinc.com/GreenFeed/sfdata.php?fid=1000119&amp;dt=2023-03-14%2018:47:22&amp;dur=60&amp;s1=20&amp;s2=23</a></td>
<td align="left">2023-03-14 18:47:32</td>
<td align="left">2023-03-14 18:48:05</td>
<td align="right">1000119</td>
<td align="right">33</td>
<td align="left">SHSF K30</td>
<td align="left">000000000840003241679559</td>
<td align="right">559</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><a href="https://greenfeed.c-lockinc.com/GreenFeed/sfdata.php?fid=1000119&amp;dt=2023-03-14%2019:30:08&amp;dur=60&amp;s1=20&amp;s2=23" class="uri">https://greenfeed.c-lockinc.com/GreenFeed/sfdata.php?fid=1000119&amp;dt=2023-03-14%2019:30:08&amp;dur=60&amp;s1=20&amp;s2=23</a></td>
<td align="left">2023-03-14 19:30:18</td>
<td align="left">2023-03-14 19:30:34</td>
<td align="right">1000119</td>
<td align="right">16</td>
<td align="left">SHSF K41</td>
<td align="left">000000000840003241679563</td>
<td align="right">490</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><a href="https://greenfeed.c-lockinc.com/GreenFeed/sfdata.php?fid=1000119&amp;dt=2023-03-14%2019:30:27&amp;dur=60&amp;s1=20&amp;s2=23" class="uri">https://greenfeed.c-lockinc.com/GreenFeed/sfdata.php?fid=1000119&amp;dt=2023-03-14%2019:30:27&amp;dur=60&amp;s1=20&amp;s2=23</a></td>
<td align="left">2023-03-14 19:30:37</td>
<td align="left">2023-03-14 19:30:55</td>
<td align="right">1000119</td>
<td align="right">18</td>
<td align="left">SHSF K41</td>
<td align="left">000000000840003241679563</td>
<td align="right">486</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><a href="https://greenfeed.c-lockinc.com/GreenFeed/sfdata.php?fid=1000119&amp;dt=2023-03-14%2019:30:57&amp;dur=60&amp;s1=20&amp;s2=23" class="uri">https://greenfeed.c-lockinc.com/GreenFeed/sfdata.php?fid=1000119&amp;dt=2023-03-14%2019:30:57&amp;dur=60&amp;s1=20&amp;s2=23</a></td>
<td align="left">2023-03-14 19:31:07</td>
<td align="left">2023-03-14 19:31:20</td>
<td align="right">1000119</td>
<td align="right">13</td>
<td align="left">SHSF K41</td>
<td align="left">000000000840003241679563</td>
<td align="right">319</td>
<td align="left">No</td>
</tr>
<tr class="odd">
<td align="left"><a href="https://greenfeed.c-lockinc.com/GreenFeed/sfdata.php?fid=1000119&amp;dt=2023-03-14%2020:01:56&amp;dur=60&amp;s1=20&amp;s2=23" class="uri">https://greenfeed.c-lockinc.com/GreenFeed/sfdata.php?fid=1000119&amp;dt=2023-03-14%2020:01:56&amp;dur=60&amp;s1=20&amp;s2=23</a></td>
<td align="left">2023-03-14 20:02:06</td>
<td align="left">2023-03-14 20:02:22</td>
<td align="right">1000119</td>
<td align="right">16</td>
<td align="left">SHSF K41</td>
<td align="left">000000000840003241679563</td>
<td align="right">495</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><a href="https://greenfeed.c-lockinc.com/GreenFeed/sfdata.php?fid=1000119&amp;dt=2023-03-14%2020:08:08&amp;dur=60&amp;s1=20&amp;s2=23" class="uri">https://greenfeed.c-lockinc.com/GreenFeed/sfdata.php?fid=1000119&amp;dt=2023-03-14%2020:08:08&amp;dur=60&amp;s1=20&amp;s2=23</a></td>
<td align="left">2023-03-14 20:08:18</td>
<td align="left">2023-03-14 20:08:30</td>
<td align="right">1000119</td>
<td align="right">12</td>
<td align="left">Beach K224</td>
<td align="left">000000000840003241679593</td>
<td align="right">350</td>
<td align="left">No</td>
</tr>
</tbody>
</table>
<p>We can see that the ‘view’ column is likely not necessary and can be removed. In addition, we will create a new column called ‘Date’ that converts the start time to a Date only value. Lastly we will convert the 14 digit RFID number to only the last 6 digits to simplify identifying unique animals.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="smartscale-api.html#cb18-1" tabindex="-1"></a><span class="co">#Remove unnecessary columns</span></span>
<span id="cb18-2"><a href="smartscale-api.html#cb18-2" tabindex="-1"></a>d.smart<span class="sc">$</span>View<span class="ot">=</span><span class="cn">NULL</span></span>
<span id="cb18-3"><a href="smartscale-api.html#cb18-3" tabindex="-1"></a></span>
<span id="cb18-4"><a href="smartscale-api.html#cb18-4" tabindex="-1"></a></span>
<span id="cb18-5"><a href="smartscale-api.html#cb18-5" tabindex="-1"></a><span class="co">#convert date time to date value to look at daily visits</span></span>
<span id="cb18-6"><a href="smartscale-api.html#cb18-6" tabindex="-1"></a>d.smart<span class="sc">$</span>Date<span class="ot">=</span><span class="fu">as.Date</span>(d.smart<span class="sc">$</span>StartTime)</span>
<span id="cb18-7"><a href="smartscale-api.html#cb18-7" tabindex="-1"></a>d.smart<span class="sc">$</span>RFIDTag<span class="ot">=</span> stringr<span class="sc">::</span> <span class="fu">str_sub</span>(d.smart<span class="sc">$</span>RFIDTag,<span class="sc">-</span><span class="dv">6</span>,<span class="sc">-</span><span class="dv">1</span>) <span class="co">#get last 6 digits of RFID</span></span></code></pre></div>
<p>One of the first steps to processing and cleaning data is to plot it. This code chunk will get the number of daily visits for each scale and plot it by day.</p>
</div>
<div id="data-visualization-1" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Data Visualization<a href="smartscale-api.html#data-visualization-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This next section is used to generate a series of quick plots to summarize visits and data from the SmartScales to check usage rates. This can be helpful to plot is animals are routinely using the equipment and to see if there are any sudden changes in usage rate that may indicate either a issue with the technology or access.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="smartscale-api.html#cb19-1" tabindex="-1"></a><span class="co">#get the number of unique animals visiting by day</span></span>
<span id="cb19-2"><a href="smartscale-api.html#cb19-2" tabindex="-1"></a>rfid_day<span class="ot">=</span>d.smart <span class="sc">%&gt;%</span>                              <span class="co"># Applying group_by &amp; summarise</span></span>
<span id="cb19-3"><a href="smartscale-api.html#cb19-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Date,FeederID) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="smartscale-api.html#cb19-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n_distinct</span>(RFIDTag))</span>
<span id="cb19-5"><a href="smartscale-api.html#cb19-5" tabindex="-1"></a></span>
<span id="cb19-6"><a href="smartscale-api.html#cb19-6" tabindex="-1"></a></span>
<span id="cb19-7"><a href="smartscale-api.html#cb19-7" tabindex="-1"></a>rfid_day<span class="ot">=</span><span class="fu">na.omit</span>(rfid_day)</span>
<span id="cb19-8"><a href="smartscale-api.html#cb19-8" tabindex="-1"></a></span>
<span id="cb19-9"><a href="smartscale-api.html#cb19-9" tabindex="-1"></a><span class="fu">ggplot</span>(rfid_day,<span class="fu">aes</span>(<span class="at">x=</span>Date,<span class="at">y=</span>count))<span class="sc">+</span></span>
<span id="cb19-10"><a href="smartscale-api.html#cb19-10" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>)<span class="sc">+</span></span>
<span id="cb19-11"><a href="smartscale-api.html#cb19-11" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>FeederID)<span class="sc">+</span></span>
<span id="cb19-12"><a href="smartscale-api.html#cb19-12" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Number of Unique animals per day&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="smartscale-api.html#cb20-1" tabindex="-1"></a><span class="co">#convert start time to date</span></span>
<span id="cb20-2"><a href="smartscale-api.html#cb20-2" tabindex="-1"></a>d.smart<span class="sc">$</span>Date<span class="ot">=</span><span class="fu">as.Date</span>(d.smart<span class="sc">$</span>StartTime)</span>
<span id="cb20-3"><a href="smartscale-api.html#cb20-3" tabindex="-1"></a></span>
<span id="cb20-4"><a href="smartscale-api.html#cb20-4" tabindex="-1"></a>d.smart<span class="sc">$</span>RFID<span class="ot">=</span>stringr<span class="sc">::</span> <span class="fu">str_sub</span>(d.smart<span class="sc">$</span>RFID,<span class="sc">-</span><span class="dv">6</span>,<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb20-5"><a href="smartscale-api.html#cb20-5" tabindex="-1"></a></span>
<span id="cb20-6"><a href="smartscale-api.html#cb20-6" tabindex="-1"></a><span class="co">#get a count on the number of good observations by each greenfeed by day</span></span>
<span id="cb20-7"><a href="smartscale-api.html#cb20-7" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb20-8"><a href="smartscale-api.html#cb20-8" tabindex="-1"></a>daily_good_data<span class="ot">=</span>d.smart <span class="sc">%&gt;%</span> <span class="fu">count</span>(FeederID, Date, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-9"><a href="smartscale-api.html#cb20-9" tabindex="-1"></a></span>
<span id="cb20-10"><a href="smartscale-api.html#cb20-10" tabindex="-1"></a>daily_good_data<span class="ot">=</span><span class="fu">na.omit</span>(daily_good_data)</span>
<span id="cb20-11"><a href="smartscale-api.html#cb20-11" tabindex="-1"></a><span class="fu">ggplot</span>(daily_good_data,<span class="fu">aes</span>(<span class="at">x=</span>Date,<span class="at">y=</span>n))<span class="sc">+</span></span>
<span id="cb20-12"><a href="smartscale-api.html#cb20-12" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>)<span class="sc">+</span></span>
<span id="cb20-13"><a href="smartscale-api.html#cb20-13" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>FeederID)<span class="sc">+</span></span>
<span id="cb20-14"><a href="smartscale-api.html#cb20-14" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Number of observations by SmartScale by day&#39;</span>)<span class="sc">+</span></span>
<span id="cb20-15"><a href="smartscale-api.html#cb20-15" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Number of daily observations&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>The smartscale data has a column named ‘Valid’ that flags potentially bad data in the system based on quantiles. The following plots show the bad data labeled as Valid = No for the entire dataset and for an individual animal.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="smartscale-api.html#cb21-1" tabindex="-1"></a><span class="co">#plot animal weight by date</span></span>
<span id="cb21-2"><a href="smartscale-api.html#cb21-2" tabindex="-1"></a><span class="fu">ggplot</span>(d.smart,<span class="fu">aes</span>(<span class="at">x=</span>Date,<span class="at">y=</span>Weight,<span class="at">color=</span>Valid))<span class="sc">+</span></span>
<span id="cb21-3"><a href="smartscale-api.html#cb21-3" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="smartscale-api.html#cb22-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">subset</span>(d.smart,RFIDTag<span class="sc">==</span><span class="st">&#39;679563&#39;</span>),<span class="fu">aes</span>(<span class="at">x=</span>Date,<span class="at">y=</span>Weight,<span class="at">color=</span>Valid))<span class="sc">+</span></span>
<span id="cb22-2"><a href="smartscale-api.html#cb22-2" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-15-2.png" width="672" /></p>
<p>This next chunk of code will remove the observations that are not valid and replot the data.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="smartscale-api.html#cb23-1" tabindex="-1"></a><span class="co">#Remove not valid points</span></span>
<span id="cb23-2"><a href="smartscale-api.html#cb23-2" tabindex="-1"></a>d.smart<span class="ot">=</span><span class="fu">subset</span>(d.smart,Valid<span class="sc">!=</span><span class="st">&#39;No&#39;</span>)</span>
<span id="cb23-3"><a href="smartscale-api.html#cb23-3" tabindex="-1"></a><span class="co">#plot animal weight by date</span></span>
<span id="cb23-4"><a href="smartscale-api.html#cb23-4" tabindex="-1"></a><span class="fu">ggplot</span>(d.smart,<span class="fu">aes</span>(<span class="at">x=</span>Date,<span class="at">y=</span>Weight))<span class="sc">+</span></span>
<span id="cb23-5"><a href="smartscale-api.html#cb23-5" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<div id="further-data-cleaning-and-filtering" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Further Data Cleaning and Filtering<a href="smartscale-api.html#further-data-cleaning-and-filtering" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This next code chunk will add day of trial to the dataframe which will help for calculating average daily gain (ADG)</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="smartscale-api.html#cb24-1" tabindex="-1"></a><span class="co"># Add days to data</span></span>
<span id="cb24-2"><a href="smartscale-api.html#cb24-2" tabindex="-1"></a>d.tdays <span class="ot">=</span> <span class="fu">data.table</span>(<span class="at">Date =</span> <span class="fu">seq.Date</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="fu">min</span>(d.smart<span class="sc">$</span>Date)), </span>
<span id="cb24-3"><a href="smartscale-api.html#cb24-3" tabindex="-1"></a>                                     <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="fu">max</span>(d.smart<span class="sc">$</span>Date)), <span class="at">by =</span> <span class="dv">1</span>), </span>
<span id="cb24-4"><a href="smartscale-api.html#cb24-4" tabindex="-1"></a>                     <span class="at">tday =</span> <span class="fu">as.numeric</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, </span>
<span id="cb24-5"><a href="smartscale-api.html#cb24-5" tabindex="-1"></a>                                           <span class="at">to =</span> <span class="fu">difftime</span>(<span class="fu">max</span>(d.smart<span class="sc">$</span>Date), <span class="fu">min</span>(d.smart<span class="sc">$</span>Date), <span class="at">units =</span> <span class="st">&quot;days&quot;</span>))))</span>
<span id="cb24-6"><a href="smartscale-api.html#cb24-6" tabindex="-1"></a>d.smart <span class="ot">=</span> d.tdays[d.smart, on <span class="ot">=</span> <span class="st">&#39;Date&#39;</span>] </span>
<span id="cb24-7"><a href="smartscale-api.html#cb24-7" tabindex="-1"></a>d.smart[, Weight<span class="sc">:=</span> <span class="fu">as.numeric</span>(Weight)]</span>
<span id="cb24-8"><a href="smartscale-api.html#cb24-8" tabindex="-1"></a>d.smart[, RFIDTag <span class="sc">:=</span> <span class="fu">as.character</span>(RFIDTag)]</span></code></pre></div>
<p>In addition to flagging the data as valid or not valid, Parsons et al., 2023 proposed an additional method using robust regression to remove potentially bad data from in pasture weighing systems. We will apply that method below <span class="citation">(Parsons et al. 2023)</span>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="smartscale-api.html#cb25-1" tabindex="-1"></a><span class="co"># Filter Spurious weights using robust regression (Parsons et al., 2023)</span></span>
<span id="cb25-2"><a href="smartscale-api.html#cb25-2" tabindex="-1"></a>m.rob <span class="ot">=</span> <span class="fu">rlm</span>(Weight <span class="sc">~</span> RFIDTag <span class="sc">+</span> tday, <span class="at">data =</span> d.smart)</span>
<span id="cb25-3"><a href="smartscale-api.html#cb25-3" tabindex="-1"></a>d.smrtrob <span class="ot">=</span> <span class="fu">data.table</span>(<span class="at">FeederID =</span> d.smart<span class="sc">$</span>FeederID, </span>
<span id="cb25-4"><a href="smartscale-api.html#cb25-4" tabindex="-1"></a>                       <span class="at">RFIDTag =</span> d.smart<span class="sc">$</span>RFIDTag,</span>
<span id="cb25-5"><a href="smartscale-api.html#cb25-5" tabindex="-1"></a>                       <span class="at">Date =</span> d.smart<span class="sc">$</span>Date,</span>
<span id="cb25-6"><a href="smartscale-api.html#cb25-6" tabindex="-1"></a>                       <span class="at">tday =</span> d.smart<span class="sc">$</span>tday,</span>
<span id="cb25-7"><a href="smartscale-api.html#cb25-7" tabindex="-1"></a>                       <span class="at">StartTime =</span> d.smart<span class="sc">$</span>StartTime,</span>
<span id="cb25-8"><a href="smartscale-api.html#cb25-8" tabindex="-1"></a>                       <span class="at">Duration =</span> d.smart<span class="sc">$</span>Duration,</span>
<span id="cb25-9"><a href="smartscale-api.html#cb25-9" tabindex="-1"></a>                       <span class="at">Weight =</span> d.smart<span class="sc">$</span>Weight,</span>
<span id="cb25-10"><a href="smartscale-api.html#cb25-10" tabindex="-1"></a>                       <span class="at">resid =</span> m.rob<span class="sc">$</span>residuals,</span>
<span id="cb25-11"><a href="smartscale-api.html#cb25-11" tabindex="-1"></a>                       <span class="at">hwt =</span> m.rob<span class="sc">$</span>w)</span>
<span id="cb25-12"><a href="smartscale-api.html#cb25-12" tabindex="-1"></a></span>
<span id="cb25-13"><a href="smartscale-api.html#cb25-13" tabindex="-1"></a><span class="do">## Assign outliers</span></span>
<span id="cb25-14"><a href="smartscale-api.html#cb25-14" tabindex="-1"></a>d.smrtrob[, Outlier <span class="sc">:=</span> <span class="fu">fifelse</span>(hwt <span class="sc">&gt;</span> <span class="fl">0.99</span>, <span class="st">&#39;In Range&#39;</span>,<span class="st">&#39;Outlier&#39;</span>)]</span>
<span id="cb25-15"><a href="smartscale-api.html#cb25-15" tabindex="-1"></a></span>
<span id="cb25-16"><a href="smartscale-api.html#cb25-16" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">subset</span>(d.smrtrob,RFIDTag<span class="sc">==</span><span class="st">&#39;679563&#39;</span>),<span class="fu">aes</span>(<span class="at">x=</span>Date,<span class="at">y=</span>Weight,<span class="at">color=</span>Outlier))<span class="sc">+</span></span>
<span id="cb25-17"><a href="smartscale-api.html#cb25-17" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="smartscale-api.html#cb26-1" tabindex="-1"></a>d.smart <span class="ot">=</span> d.smrtrob[Outlier <span class="sc">==</span> <span class="st">&#39;In Range&#39;</span>, ] <span class="co"># Filter to in range points</span></span></code></pre></div>
<p>Using the table function we will get the number of daily weights for each individual animal. We can see that several tags only have a few observations while others have hundreds. These are could be test tags that were used to test the scales or had animals that infrequently used the equipement. The code below will delete individual tags with less than 6 observations.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="smartscale-api.html#cb27-1" tabindex="-1"></a><span class="fu">table</span>(d.smart<span class="sc">$</span>RFIDTag)</span></code></pre></div>
<pre><code>## 
## 030197 030226 030296 030312 605891 605892 605893 605896 605899 679558 679559 679560 
##      6      1      2      1    242    252    368    355    325    282    241    243 
## 679563 679572 679573 679590 679591 679593 679594 679596 679605 679608 679612 679617 
##    337     70     57    402    231    229    341    317    132    337    143    337 
## 679619 679622 679629 679633 679635 679663 679795 679814 679817 679822 680396 680410 
##    337    212    175    240    293      2      4      2      6      2    245    260 
## 680411 680412 680413 680414 828028 828031 828038 
##    336    259    270    306    218    296    339</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="smartscale-api.html#cb29-1" tabindex="-1"></a>d.smart<span class="ot">=</span>d.smart <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(RFIDTag) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">n</span>()<span class="sc">&gt;=</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb29-2"><a href="smartscale-api.html#cb29-2" tabindex="-1"></a><span class="fu">table</span>(d.smart<span class="sc">$</span>RFIDTag)</span></code></pre></div>
<pre><code>## 
## 030197 605891 605892 605893 605896 605899 679558 679559 679560 679563 679572 679573 
##      6    242    252    368    355    325    282    241    243    337     70     57 
## 679590 679591 679593 679594 679596 679605 679608 679612 679617 679619 679622 679629 
##    402    231    229    341    317    132    337    143    337    337    212    175 
## 679633 679635 679817 680396 680410 680411 680412 680413 680414 828028 828031 828038 
##    240    293      6    245    260    336    259    270    306    218    296    339</code></pre>
</div>
</div>
<div id="animal-performance" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Animal Performance<a href="smartscale-api.html#animal-performance" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Next we want to calculate the average daily gain. To do so we can fit a linear regression to get a model for to estimate weight by day of trial. If we wanted to fit a linear model to the entire herd we can do so using all available data with Weight as our y and trial day as our x. The code below fits this linear model.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="smartscale-api.html#cb31-1" tabindex="-1"></a>model_all_animals<span class="ot">=</span><span class="fu">lm</span>(Weight<span class="sc">~</span>tday,<span class="at">data=</span>d.smart)</span>
<span id="cb31-2"><a href="smartscale-api.html#cb31-2" tabindex="-1"></a><span class="fu">summary</span>(model_all_animals)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Weight ~ tday, data = d.smart)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -152.417  -23.256   -3.834   28.501  171.551 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 536.47638    0.85231   629.4   &lt;2e-16 ***
## tday          1.96788    0.01905   103.3   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 39.93 on 9037 degrees of freedom
## Multiple R-squared:  0.5414, Adjusted R-squared:  0.5413 
## F-statistic: 1.067e+04 on 1 and 9037 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>We can see that the intercept of the model is 536, which would equate to our average starting weight for the herd and the slope is 1.96 which would equate to our average daily gain (ADG). Plotting it we can see the relationship.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="smartscale-api.html#cb33-1" tabindex="-1"></a><span class="fu">ggplot</span>(d.smart,<span class="fu">aes</span>(<span class="at">y=</span>Weight,<span class="at">x=</span>tday))<span class="sc">+</span></span>
<span id="cb33-2"><a href="smartscale-api.html#cb33-2" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb33-3"><a href="smartscale-api.html#cb33-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Though herd level ADG is important, using precision data we can also look at individual animal ADG. To do so we need to run a linear model for each individual animal. The code below will loop through each individual animal, subset the data based on RFID tag, create a linear model as above, extract the slope and intercept for the model, and save them in a new dataframe that contains the RFIDtag, slope, and intercept for each individual animal.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="smartscale-api.html#cb34-1" tabindex="-1"></a>ADG_individual<span class="ot">=</span><span class="fu">data.frame</span>()   </span>
<span id="cb34-2"><a href="smartscale-api.html#cb34-2" tabindex="-1"></a></span>
<span id="cb34-3"><a href="smartscale-api.html#cb34-3" tabindex="-1"></a></span>
<span id="cb34-4"><a href="smartscale-api.html#cb34-4" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(d.smart<span class="sc">$</span>RFIDTag))){</span>
<span id="cb34-5"><a href="smartscale-api.html#cb34-5" tabindex="-1"></a>    </span>
<span id="cb34-6"><a href="smartscale-api.html#cb34-6" tabindex="-1"></a>    sublm<span class="ot">=</span><span class="fu">subset</span>(d.smart,RFIDTag<span class="sc">==</span><span class="fu">unique</span>(d.smart<span class="sc">$</span>RFIDTag)[i])</span>
<span id="cb34-7"><a href="smartscale-api.html#cb34-7" tabindex="-1"></a>    mod<span class="ot">=</span><span class="fu">lm</span>(sublm<span class="sc">$</span>Weight<span class="sc">~</span>sublm<span class="sc">$</span>tday)</span>
<span id="cb34-8"><a href="smartscale-api.html#cb34-8" tabindex="-1"></a>    int<span class="ot">=</span> mod<span class="sc">$</span>coefficients[<span class="dv">1</span>]</span>
<span id="cb34-9"><a href="smartscale-api.html#cb34-9" tabindex="-1"></a>    slope<span class="ot">=</span>mod<span class="sc">$</span>coefficients[<span class="dv">2</span>]</span>
<span id="cb34-10"><a href="smartscale-api.html#cb34-10" tabindex="-1"></a></span>
<span id="cb34-11"><a href="smartscale-api.html#cb34-11" tabindex="-1"></a>    </span>
<span id="cb34-12"><a href="smartscale-api.html#cb34-12" tabindex="-1"></a>    sub_df<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">unique</span>(sublm<span class="sc">$</span>RFIDTag),int,slope)</span>
<span id="cb34-13"><a href="smartscale-api.html#cb34-13" tabindex="-1"></a>    ADG_individual<span class="ot">=</span><span class="fu">rbind</span>(ADG_individual,sub_df)</span>
<span id="cb34-14"><a href="smartscale-api.html#cb34-14" tabindex="-1"></a>}</span>
<span id="cb34-15"><a href="smartscale-api.html#cb34-15" tabindex="-1"></a></span>
<span id="cb34-16"><a href="smartscale-api.html#cb34-16" tabindex="-1"></a><span class="fu">row.names</span>(ADG_individual) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<p>Plotting the data we can see the slope and intercept for each animal with the RFID tag.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="smartscale-api.html#cb35-1" tabindex="-1"></a><span class="fu">colnames</span>(ADG_individual)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&#39;RFIDTag&#39;</span>,<span class="st">&#39;Intercept&#39;</span>,<span class="st">&#39;Slope&#39;</span>)</span>
<span id="cb35-2"><a href="smartscale-api.html#cb35-2" tabindex="-1"></a></span>
<span id="cb35-3"><a href="smartscale-api.html#cb35-3" tabindex="-1"></a></span>
<span id="cb35-4"><a href="smartscale-api.html#cb35-4" tabindex="-1"></a><span class="fu">ggplot</span>(ADG_individual,<span class="fu">aes</span>(<span class="at">x=</span>Intercept,<span class="at">y=</span>Slope,<span class="at">label=</span>RFIDTag))<span class="sc">+</span></span>
<span id="cb35-5"><a href="smartscale-api.html#cb35-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">2</span>,<span class="at">color=</span><span class="st">&#39;Red&#39;</span>)<span class="sc">+</span></span>
<span id="cb35-6"><a href="smartscale-api.html#cb35-6" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">hjust=</span><span class="dv">0</span>, <span class="at">vjust=</span><span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb35-7"><a href="smartscale-api.html#cb35-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;ADG and Starting Weight for Individual Animals&#39;</span>)<span class="sc">+</span></span>
<span id="cb35-8"><a href="smartscale-api.html#cb35-8" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Starting Weight (Intercept) in Lbs&quot;</span>)<span class="sc">+</span></span>
<span id="cb35-9"><a href="smartscale-api.html#cb35-9" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;ADG (Slope) in Lbs </span><span class="sc">\n</span><span class="st">&#39;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="greenfeed-api.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="smartfeeder-api.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
